\begin{code}
module ScmQE.Semantic-Functions where

open import Notation
open import ScmQE.Abstract-Syntax
open import ScmQE.Domain-Equations
open import ScmQE.Auxiliary-Functions

ğ’¦âŸ¦_âŸ§    : Con â†’ ğ„
ğ’ŸâŸ¦_âŸ§    : Dat â†’ (ğ„ â†’ ğ‚) â†’ ğ‚
ğ’Ÿâ‹†âŸ¦_âŸ§   : Datâ‹† â†’ (ğ„ â†’ ğ‚) â†’ ğ‚
ğ’ŸâºâŸ¦_âŸ§   : Datâº â†’ ğ„ â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

â„°âŸ¦_âŸ§    : Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚
â„°â‹†âŸ¦_âŸ§   : Expâ‹† â†’ ğ” â†’ (ğ„â‹† â†’ ğ‚) â†’ ğ‚
â„±_âŸ¦_âŸ§   : (Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚) â†’ Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚
â„±â‹†_âŸ¦_âŸ§  : (Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚) â†’ Expâ‹† â†’ ğ” â†’ (ğ„ â‹† â†’ ğ‚) â†’ ğ‚

â„¬âŸ¦_âŸ§    : Body â†’ ğ” â†’ (ğ” â†’ ğ‚) â†’ ğ‚
â„¬âºâŸ¦_âŸ§   : Bodyâº â†’ ğ” â†’ (ğ” â†’ ğ‚) â†’ ğ‚
ğ’«âŸ¦_âŸ§    : Prog â†’ ğ€

-- Constant denotations ğ’¦âŸ¦ K âŸ§ : ğ„

ğ’¦âŸ¦ int Z âŸ§  = Î· Z ğ‘-in-ğ„
ğ’¦âŸ¦ #t âŸ§     = Î· true ğ“-in-ğ„
ğ’¦âŸ¦ #f âŸ§     = Î· false ğ“-in-ğ„

-- Datum denotations ğ’ŸâŸ¦ Î” âŸ§ : (ğ„ â†’ ğ‚) â†’ ğ‚

ğ’ŸâŸ¦ con K âŸ§ Îº        = Îº(ğ’¦âŸ¦ K âŸ§)
ğ’ŸâŸ¦ ide I âŸ§ Îº        = Îº(Î· I ğ-in-ğ„)
ğ’ŸâŸ¦ key X âŸ§ Îº        = Îº(Î· X ğ—-in-ğ„)
ğ’ŸâŸ¦ â€² Î” âŸ§ Îº          = ğ’ŸâŸ¦ Î” âŸ§ Îº
ğ’ŸâŸ¦ â¦… Î”â‹† â¦† âŸ§ Îº       = ğ’Ÿâ‹†âŸ¦ Î”â‹† âŸ§ Îº
ğ’ŸâŸ¦ â¦… Î”âº Â· Î” â¦† âŸ§ Îº   = ğ’ŸâŸ¦ Î” âŸ§ (Î» Ïµ â†’ ğ’ŸâºâŸ¦ Î”âº âŸ§ Ïµ Îº)
ğ’ŸâŸ¦ #proc âŸ§ Îº        = âŠ¥

-- Datum sequence denotations ğ’Ÿâ‹†âŸ¦ Î”â‹† âŸ§ : (ğ„ â†’ ğ‚) â†’ ğ‚

ğ’Ÿâ‹†âŸ¦ â£â£â£ âŸ§ Îº = Îº (Î· null ğŒ-in-ğ„)

ğ’Ÿâ‹†âŸ¦ Î”â‚ â£â£ Î”â‹† âŸ§ Îº =
  ğ’ŸâŸ¦ Î”â‚ âŸ§ (Î» Ïµâ‚ â†’
    ğ’Ÿâ‹†âŸ¦ Î”â‹† âŸ§ (Î» Ïµ â†’
      cons âŸ¨ Ïµâ‚ , Ïµ âŸ© Îº))

-- Datum prefix sequence denotations ğ’ŸâºâŸ¦ Î”âº âŸ§ : ğ„ â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

ğ’ŸâºâŸ¦ â£â£ Î”â‚ âŸ§ Ïµ Îº =
  ğ’ŸâŸ¦ Î”â‚ âŸ§ (Î» Ïµâ‚ â†’
    cons âŸ¨ Ïµâ‚ , Ïµ âŸ© Îº)

ğ’ŸâºâŸ¦ Î”âº â£â£ Î”â‚ âŸ§ Ïµ Îº =
  ğ’ŸâŸ¦ Î”â‚ âŸ§ (Î» Ïµâ‚ â†’
    cons âŸ¨ Ïµâ‚ , Ïµ âŸ© (Î» Ïµâ€² â†’
    ğ’ŸâºâŸ¦ Î”âº âŸ§ Ïµâ€² Îº))
\end{code}
\clearpage
\begin{code}
-- Fixed expression denotations â„°âŸ¦ E âŸ§ : ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

â„°âŸ¦ E âŸ§ = â„± (fix â„±_âŸ¦_âŸ§) âŸ¦ E âŸ§

-- Fixed expression sequence denotations â„°â‹†âŸ¦_âŸ§  : Expâ‹† â†’ ğ” â†’ (ğ„â‹† â†’ ğ‚) â†’ ğ‚

â„°â‹†âŸ¦ Eâ‹† âŸ§ = â„±â‹† (fix â„±_âŸ¦_âŸ§) âŸ¦ Eâ‹† âŸ§

-- Expression denotations â„± â„°â€² âŸ¦ E âŸ§ : ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

â„± â„°â€² âŸ¦ con K âŸ§ Ï Îº = Îº (ğ’¦âŸ¦ K âŸ§)

â„± â„°â€² âŸ¦ ide I âŸ§ Ï Îº = hold (Ï I) Îº

â„± â„°â€² âŸ¦ â¦… E â£ Eâ‹† â¦† âŸ§ Ï Îº =
  â„± â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµ â†’
    â„±â‹† â„°â€² âŸ¦ Eâ‹† âŸ§ Ï (Î» Ïµâ‹† â†’
      (Ïµ |-ğ…) Ïµâ‹† Îº))

â„± â„°â€² âŸ¦ â¦…lambda I â£ E â¦† âŸ§ Ï Îº =
  Îº (  (Î» Ïµâ‹† Îºâ€² â†’
          list Ïµâ‹† (Î» Ïµ â†’ 
            alloc Ïµ (Î» Î± â†’
              â„± â„°â€² âŸ¦ E âŸ§ (Ï [ Î± / I ]) Îºâ€²))
       ) ğ…-in-ğ„)

â„± â„°â€² âŸ¦ â¦…if E â£ Eâ‚ â£ Eâ‚‚ â¦† âŸ§ Ï Îº =
  â„± â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµ â†’
    truish Ïµ âŸ¶ â„± â„°â€² âŸ¦ Eâ‚ âŸ§ Ï Îº , â„± â„°â€² âŸ¦ Eâ‚‚ âŸ§ Ï Îº)

â„± â„°â€² âŸ¦ â¦…set! I â£ E â¦† âŸ§ Ï Îº =
  â„± â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµ â†’
    assign (Ï I) Ïµ (
      Îº (Î· unspecified ğŒ-in-ğ„)))

â„± â„°â€² âŸ¦ â¦…quote Î” â¦† âŸ§ Ï Îº = ğ’ŸâŸ¦ Î” âŸ§ Îº

â„± â„°â€² âŸ¦ â¦…eval E â¦† âŸ§ Ï Îº =
  â„± â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµ â†’
    datum Ïµ (Î» Î” â†’ â„°â€² (expâŸ¦ Î” âŸ§) nullenv Îº))

â„± â„°â€² âŸ¦ â¦…â£â¦† âŸ§ Ï Îº = âŠ¥

-- Expression sequence denotations â„±â‹† â„°â€² âŸ¦ Eâ‹† âŸ§ : ğ” â†’ (ğ„â‹† â†’ ğ‚) â†’ ğ‚

â„±â‹† â„°â€² âŸ¦ â£â£â£ âŸ§ Ï Îº = Îº âŸ¨âŸ©

â„±â‹† â„°â€² âŸ¦ E â£â£ Eâ‹† âŸ§ Ï Îº =
  â„± â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµ â†’
    â„±â‹† â„°â€² âŸ¦ Eâ‹† âŸ§ Ï (Î» Ïµâ‹† â†’
      Îº (âŸ¨ Ïµ âŸ© Â§ Ïµâ‹†)))
\end{code}
\clearpage
\begin{code}
-- Body denotations â„¬âŸ¦ B âŸ§ : ğ” â†’ (ğ” â†’ ğ‚) â†’ ğ‚

â„¬âŸ¦ â£â£ E âŸ§ Ï Îº = â„°âŸ¦ E âŸ§ Ï (Î» Ïµ â†’ Îº Ï)

â„¬âŸ¦ â¦…define I â£ E â¦† âŸ§ Ï Îº =
  â„°âŸ¦ E âŸ§ Ï (Î» Ïµ â†’ (Ï I ==á´¸ unknown) âŸ¶ 
                      alloc Ïµ (Î» Î± â†’ Îº (Ï [ Î± / I ])),
                    assign (Ï I) Ïµ (Îº Ï))

â„¬âŸ¦ â¦…begin Bâº â¦† âŸ§ Ï Îº = â„¬âºâŸ¦ Bâº âŸ§ Ï Îº

-- Body sequence denotations â„¬âºâŸ¦ Bâº âŸ§ : ğ” â†’ (ğ” â†’ ğ‚) â†’ ğ‚

â„¬âºâŸ¦ â£â£ B âŸ§ Ï Îº = â„¬âŸ¦ B âŸ§ Ï Îº

â„¬âºâŸ¦ B â£â£ Bâº âŸ§ Ï Îº = â„¬âŸ¦ B âŸ§ Ï (Î» Ïâ€² â†’ â„¬âºâŸ¦ Bâº âŸ§ Ïâ€² Îº)

-- Program denotations ğ’«âŸ¦ Î  âŸ§ : ğ€

ğ’«âŸ¦ â£â£â£ âŸ§ = finished initial-store

ğ’«âŸ¦ â£â£ Bâº âŸ§ = â„¬âºâŸ¦ Bâº âŸ§ nullenv (Î» Ï â†’ finished) initial-store
\end{code}