\begin{code}

module PrimSchemeQED.Semantic-Functions where

open import PrimSchemeQED.Domain-Notation
open import PrimSchemeQED.Abstract-Syntax
open import PrimSchemeQED.Domain-Equations
open import PrimSchemeQED.Auxiliary-Functions

-- 7.2.3. Semantic functions

-- Constant denotations

ğ’¦âŸ¦_âŸ§ : Con â†’ ğ„

ğ’¦âŸ¦ int Z  âŸ§ = (Î· Z) ğ‘-in-ğ„
ğ’¦âŸ¦ #t     âŸ§ = (Î· true) ğ“-in-ğ„
ğ’¦âŸ¦ #f     âŸ§ = (Î· false) ğ“-in-ğ„

-- Datum denotations

ğ’ŸâŸ¦_âŸ§    : Dat â†’ (ğ„ â†’ ğ‚) â†’ ğ‚
ğ’Ÿâ‹†âŸ¦_âŸ§   : Dat â‹†â€² â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

-- ğ’ŸâŸ¦_âŸ§   : Dat â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

ğ’ŸâŸ¦ con K       âŸ§  = Î» Îº â†’ Îº(ğ’¦âŸ¦ K âŸ§)
ğ’ŸâŸ¦ ide I       âŸ§  = Î» Îº â†’ Îº((Î· I) ğ-in-ğ„)
ğ’ŸâŸ¦ key X       âŸ§  = Î» Îº â†’ Îº((Î· X) ğ—-in-ğ„)
ğ’ŸâŸ¦ â€² Î”         âŸ§  = ğ’ŸâŸ¦ Î” âŸ§ 
ğ’ŸâŸ¦ â¦… Î”â‹† â¦†      âŸ§  = ğ’Ÿâ‹†âŸ¦ Î”â‹† âŸ§ 
ğ’ŸâŸ¦ â¦… Î”â‹† Â· Î” â¦†  âŸ§  = Î» Îº â†’
  ğ’Ÿâ‹†âŸ¦ Î”â‹† âŸ§ (Î» Ïµâ‚€ â†’
    ğ’ŸâŸ¦ Î” âŸ§  (Î» Ïµâ‚ â†’
      cons âŸ¨ Ïµâ‚€ , Ïµâ‚ âŸ© Îº))

-- ğ’Ÿâ‹†âŸ¦_âŸ§  : Dat â‹†â€² â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

ğ’Ÿâ‹†âŸ¦ 0 , _  âŸ§  = Î» Îº â†’ Îº null-in-ğ„

ğ’Ÿâ‹†âŸ¦ 1 , Î”  âŸ§  = Î» Îº â†’
  ğ’ŸâŸ¦ Î” âŸ§ (Î» Ïµ â†’
      cons âŸ¨ Ïµ , null-in-ğ„ âŸ© Îº)

ğ’Ÿâ‹†âŸ¦ suc (suc n) , Î” , Î”â‹† âŸ§ = Î» Îº â†’
  ğ’ŸâŸ¦ Î” âŸ§ (Î» Ïµâ‚€ â†’
    ğ’Ÿâ‹†âŸ¦ suc n , Î”â‹† âŸ§ (Î» Ïµâ‚ â†’
      cons âŸ¨ Ïµâ‚€ , Ïµâ‚ âŸ© Îº))
\end{code}
\clearpage
\begin{code}
-- Expression denotations

â„°_âŸ¦_âŸ§   : (Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚) â†’ Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚
â„°â‹†_âŸ¦_âŸ§  : (Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚) â†’ Exp â‹†â€² â†’ ğ” â†’ (ğ„ â‹† â†’ ğ‚) â†’ ğ‚

-- â„°_âŸ¦_âŸ§   : Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

â„° â„°â€² âŸ¦ con K âŸ§ = Î» Ï Îº â†’ Îº (ğ’¦âŸ¦ K âŸ§)

â„° â„°â€² âŸ¦ ide I âŸ§ = Î» Ï Îº â†’
  â—… Î» Ïƒ â†’ â–» (Îº (â–» Ïƒ (â–» Ï I))) Ïƒ

â„° â„°â€² âŸ¦ â¦… Eâ‚€ â£ Eâ‹† â¦† âŸ§ = Î» Ï Îº â†’
  â„° â„°â€² âŸ¦ Eâ‚€ âŸ§ Ï (Î» Ïµâ‚€ â†’
    â„°â‹† â„°â€² âŸ¦ Eâ‹† âŸ§ Ï (Î» Ïµâ‹† â†’
      â–» (Ïµâ‚€ |ğ…) Ïµâ‹† Îº))

â„° â„°â€² âŸ¦ â¦…lambdaâ£â¦… Iâ‹† â¦† Eâ‚€ â¦† âŸ§ = Î» Ï Îº â†’
  Îº (â—… ( Î» Ïµâ‹† Îºâ€² â†’
          tievals
            (Î» Î±â‹† â†’ â„° â„°â€² âŸ¦ Eâ‚€ âŸ§ (extends Ï Iâ‹† Î±â‹†) Îºâ€²)
            Ïµâ‹†
        ) ğ…-in-ğ„)

â„° â„°â€² âŸ¦ â¦…if Eâ‚€ â£ Eâ‚ â£ Eâ‚‚ â¦† âŸ§ = Î» Ï Îº â†’ 
  â„° â„°â€² âŸ¦ Eâ‚€ âŸ§ Ï (Î» Ïµ â†’
    truish Ïµ âŸ¶ â„° â„°â€² âŸ¦ Eâ‚ âŸ§ Ï Îº ,
      â„° â„°â€² âŸ¦ Eâ‚‚ âŸ§ Ï Îº)

â„° â„°â€² âŸ¦ â¦…set! I â£ E â¦† âŸ§ = Î» Ï Îº â†’
  â„° â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµ â†’
    â—… Î» Ïƒ â†’ â–» (Îº unspecified-in-ğ„) (Ïƒ [ Ïµ / (â–» Ï I) ]â€²))

â„° â„°â€² âŸ¦ â¦…quote Î” â¦† âŸ§ = Î» Ï Îº â†’ ğ’ŸâŸ¦ Î” âŸ§ Îº

â„° â„°â€² âŸ¦ â€² Î” âŸ§ = Î» Ï Îº â†’ ğ’ŸâŸ¦ Î” âŸ§ Îº

â„° â„°â€² âŸ¦ â¦…eval E â¦† âŸ§ = Î» Ï Îº â†’
  â„° â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµ â†’
    datum Ïµ (Î» Ïµâ€² â†’
      (Î» Eâ€² â†’  â„°â€² Eâ€² Ï Îº) ((exp â™¯) (Ïµâ€² |ğƒ))))

â„° â„°â€² âŸ¦ â¦…â£â¦† âŸ§ = Î» Ï Îº â†’ âŠ¥

-- â„°â‹†_âŸ¦_âŸ§  : Exp â‹†â€² â†’ ğ” â†’ (ğ„ â‹† â†’ ğ‚) â†’ ğ‚

â„°â‹† â„°â€² âŸ¦ 0 , _ âŸ§  = Î» Ï Îº â†’ Îº âŸ¨âŸ©

â„°â‹† â„°â€² âŸ¦ 1 , E âŸ§  = Î» Ï Îº â†’
  â„° â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµ â†’ Îº âŸ¨ Ïµ âŸ© )

â„°â‹† â„°â€² âŸ¦ suc (suc n) , E , Es âŸ§ = Î» Ï Îº â†’
  â„° â„°â€² âŸ¦ E âŸ§ Ï (Î» Ïµâ‚€ â†’
    â„°â‹† â„°â€² âŸ¦ suc n , Es âŸ§ Ï (Î» Ïµâ‹† â†’
      Îº (âŸ¨ Ïµâ‚€ âŸ© Â§ Ïµâ‹†)))

-- Program denotations

ğ’«âŸ¦_âŸ§ : Exp â†’ ğ” â†’ (ğ„ â†’ ğ‚) â†’ ğ‚

ğ’«âŸ¦ E âŸ§ = â„° (fix â„°_âŸ¦_âŸ§) âŸ¦ E âŸ§

\end{code} 